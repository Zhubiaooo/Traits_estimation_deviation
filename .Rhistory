Hmax_glmer1
### Remove perennials
mod12 <- glmer(exist_prob ~ (Hmax_green_log) + (1|Block/Plot_num), na.action=na.omit, family=binomial, data=composition_change_common_exist2)
Anova(mod12)
summary(mod12)
MuMIn::r.squaredGLMM(mod12)
composition_change_common_exist2$F0 = predictSE(mod12, composition_change_common_exist2, level = 0)$fit
composition_change_common_exist2$SE <- predictSE(mod12, composition_change_common_exist2, level = 0)$se.fit
Hmax_glmer2 = ggplot(composition_change_common_exist2, aes(x=(Hmax_green_log), y=exist_prob)) +
geom_point(aes(fill = Origin),size = 2.2, pch = 21) + # fill = "#00000022", color = "#0A0A0A"
geom_line(aes(y=F0), size=1, linetype = 2) + #color = "#8B0000"
labs(x = ' \n ',
y = ' \n ',
title = "Maximum height") +
mytheme +
scale_fill_manual(values = c('#60A7A6','#FEA6A6'))+
scale_x_continuous(labels = scales::label_comma(accuracy =0.01)) +
scale_y_continuous(labels = scales::label_comma(accuracy =0.01)) +
geom_line(aes(y =  F0 - 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
geom_line(aes(y =  F0 + 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
annotate('text',x = 1.2,y=0.75,label=('Z = 1.93 \n R2 = 0.022 \n p = 0.053'),size=4,color='black')
Hmax_glmer2
### AGB
unique(composition_change_common_exist$Species)
mod12 <- glmer(exist_prob ~ (AGB_green_log) + (1|Block/Plot_num), na.action=na.omit, family=binomial, data=composition_change_common_exist)
Anova(mod12)
summary(mod12)
MuMIn::r.squaredGLMM(mod12)
composition_change_common_exist$F0 = predictSE(mod12, composition_change_common_exist, level = 0)$fit
composition_change_common_exist$SE <- predictSE(mod12, composition_change_common_exist, level = 0)$se.fit
AGB_glmer1 = ggplot(composition_change_common_exist, aes(x=(AGB_green_log), y=exist_prob)) +
geom_point(aes(fill = Origin),size = 2.2, pch = 21) + # fill = "#00000022", color = "#0A0A0A"
geom_line(aes(y=F0), size=1, linetype = 1) + #color = "#8B0000"
labs(x = ' \n ',
y = ' \n ',
title = "Aboveground biomass") +
mytheme +
scale_fill_manual(values = c('#60A7A6','#FEA6A6'))+
scale_x_continuous(labels = scales::label_comma(accuracy =0.01)) +
scale_y_continuous(labels = scales::label_comma(accuracy =0.01)) +
geom_line(aes(y =  F0 - 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
geom_line(aes(y =  F0 + 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
annotate('text',x = 0,y=0.75,label=('Z = 2.12 \n R2 = 0.021 \n p = 0.034'),size=4,color='black')
AGB_glmer1
### Remove perennials
mod12 <- glmer(exist_prob ~ (AGB_green_log) + (1|Block/Plot_num), na.action=na.omit, family=binomial, data=composition_change_common_exist2)
Anova(mod12)
summary(mod12)
MuMIn::r.squaredGLMM(mod12)
composition_change_common_exist2$F0 = predictSE(mod12, composition_change_common_exist2, level = 0)$fit
composition_change_common_exist2$SE <- predictSE(mod12, composition_change_common_exist2, level = 0)$se.fit
AGB_glmer2 = ggplot(composition_change_common_exist2, aes(x=(AGB_green_log), y=exist_prob)) +
geom_point(aes(fill = Origin),size = 2.2, pch = 21) + # fill = "#00000022", color = "#0A0A0A"
geom_line(aes(y=F0), size=1, linetype = 1) + #color = "#8B0000"
labs(x = ' \n ',
y = ' \n ',
title = "Aboveground biomass") +
mytheme +
scale_fill_manual(values = c('#60A7A6','#FEA6A6'))+
scale_x_continuous(labels = scales::label_comma(accuracy =0.01)) +
scale_y_continuous(labels = scales::label_comma(accuracy =0.01)) +
geom_line(aes(y =  F0 - 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
geom_line(aes(y =  F0 + 1.96 * SE), color = "grey40", linetype = "dashed", size=0.6) +
annotate('text',x = 0,y=0.75,label=('Z = 3.15 \n R2 = 0.067 \n p = 0.002'),size=4,color='black')
AGB_glmer2
### Fig S3
SLA_glmer1+Hmax_glmer1+AGB_glmer1+SLA_lmer1+Hmax_lmer1+AGB_lmer1+
plot_layout(ncol = 3, nrow = 2) +
plot_annotation(tag_levels = 'a')
### Fig S3 (Remove perennials)
SLA_glmer2+Hmax_glmer2+AGB_glmer2+SLA_lmer2+Hmax_lmer2+AGB_lmer2+
plot_layout(ncol = 3, nrow = 2) +
plot_annotation(tag_levels = 'a')
################################################################################
#################################   Fig S1   ###################################
################################################################################
### Sensitivity analysis
### Traits deviation estimation
### Loading pot experiment database
pot_trait = read.xlsx("Data/Pot_traits_mean.xlsx", sheet = "Pot_means", colNames = TRUE, rowNames = FALSE)
colnames(pot_trait) <- paste0(colnames(pot_trait), "_green")
colnames(pot_trait)[1] <- "Species"
################################################################################
#################################   Fig S1   ###################################
################################################################################
### Sensitivity analysis
### Traits deviation estimation
### Loading pot experiment database
pot_trait = read.xlsx("Data/Pot_traits_mean.xlsx", sheet = "Pot_means", colNames = TRUE, rowNames = FALSE)
colnames(pot_trait) <- paste0(colnames(pot_trait), "_green")
colnames(pot_trait)[1] <- "Species"
pot_trait = pot_trait[pot_trait$Species %in% unique(Common_sp_list_SLA), ]
unique(pot_trait$Species)
### Loading field experiment database
trait_data = read.xlsx("Data/Field_traits_mean.xlsx", sheet = "Field_means", colNames = TRUE, rowNames = FALSE)
colnames(trait_data) <- paste0(colnames(trait_data), "_field")
colnames(trait_data)[1] <- "Species"
trait_data = trait_data[trait_data$Species %in% unique(Common_sp_list_SLA), ]
unique(trait_data$Species)
trait_data = trait_data %>% left_join(pot_trait, by = "Species") %>%
left_join(Common_sp_list[,c(1,2,5)], by= "Species")
length(unique(trait_data$Species))
trait_data$Origin = factor(trait_data$Origin, levels = c("Native", "Exotic"))
summary(lm(log10(SLA_field)~ log10(SLA_green), data = trait_data))
ma.test <- sma(SLA_field ~ SLA_green, log='xy', slope.test=1, data = trait_data, type = "shift", na.action = na.omit)
ma.test$n
summary(ma.test)
df2 = (trait_data %>% arrange(desc(SLA_field)))[c(1:6),]
df3 = (trait_data %>% arrange((SLA_field)))[c(1:6),]
p1 = ggplot(trait_data, mapping = aes(x = log10(SLA_green) , y = log10(SLA_field))) +
geom_point(trait_data, mapping = aes(x = log10(SLA_green) , y = log10(SLA_field), shape = Origin, fill = Origin),size=2.2, color = "black")+
scale_shape_manual(values = c(21,21))+
scale_color_manual(values=c('#60A7A6','#FEA6A6'))+
scale_fill_manual(values=c('#60A7A6','#FEA6A6'))+
scale_x_continuous(labels = scales::label_comma(accuracy =0.1)) +
scale_y_continuous(labels = scales::label_comma(accuracy =0.1)) +
labs(x = 'Specific leaf area (cm2/g, log10) \nestimated in pot experiment',
y = 'Specific leaf area (cm2/g, log10) \nestimated in field experiment') +
geom_abline(intercept=1.353949 ,slope=0.4013532 ,size=.8, linetype = 1)+
mytheme +
annotate('text',x = 1.8,y=2.2,label=('R2 = 0.083 \n p = 0.048'),size=4,color='black') +
ggrepel::geom_text_repel(aes(label=Species), df2,size = 2.5,segment.color = "black", color = "black",direction = "both",box.padding = 0.7,
max.overlaps = getOption("ggrepel.max.overlaps", default = 100)) +
ggrepel::geom_text_repel(aes(label=Species), df3,size = 2.5,segment.color = "black", color = "black",direction = "both",box.padding = 0.7,
max.overlaps = getOption("ggrepel.max.overlaps", default = 100))
p1
### DI
library(funrar)
standr = function(x){(x-min(x))/(max(x)-min(x))}
r2 <- function(x) {x$`Sum Sq`[1]/ (x$`Sum Sq`[1] + x$`Sum Sq`[2])}
trait_data = read.xlsx("Data/Field_traits_mean.xlsx", sheet = "Field_means", colNames = TRUE, rowNames = FALSE)
colnames(trait_data) <- paste0(colnames(trait_data), "_field")
colnames(trait_data)[1] <- "Species"
trait_data = trait_data %>% left_join(pot_trait, by = "Species") %>% drop_na(SLA_green) %>% drop_na(SLA_field)
rownames(trait_data) = trait_data$Species
length(unique(trait_data$Species))
trait_data$SLA_field_log = log10(trait_data$SLA_field)
trait_data$SLA_green_log = log10(trait_data$SLA_green)
### Pot experiment SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_green_log'], metric = 'euclidean',center = TRUE, scale = TRUE)
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_green_dis <- data.frame(SLA_green_mean = mean_vals, SLA_green_sd = sd_vals, SLA_green_se = se_vals)
### Field SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_field_log'], metric = 'euclidean',center = TRUE, scale = TRUE)#gower
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_field_dis <- data.frame(SLA_field_mean = mean_vals, SLA_field_sd = sd_vals, SLA_field_se = se_vals)
SLA_total_dis = cbind(SLA_green_dis, SLA_field_dis)
SLA_total_dis$Species = rownames(SLA_total_dis)
SLA_total_dis = SLA_total_dis %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
#### Deming regression
fit <- deming(SLA_field_mean ~ SLA_green_mean, ystd=SLA_field_sd, xstd=SLA_green_sd, data=SLA_total_dis)
print(fit)
SLA_total_dis$Origin = factor(SLA_total_dis$Origin, levels = c("Native","Exotic"))
###
phylogenyAux = read.tree("Data/All_species.newick")
to_drop = phylogenyAux$tip.label[!phylogenyAux$tip.label %in% trait_data$Species]
tree <- drop.tip(as.phylo(phylogenyAux), to_drop)
Test_total_dis = SLA_total_dis
library(openxlsx)
library(V.PhyloMaker)
library(plantlist)
library(ape)
library(tidyverse)
library(treeio)
library(ggtree)
library(rphylopic)
library(patchwork)
setwd(getwd())
### Loading tree file
tree <- read.tree("Data/All_species.newick") |> multi2di()
plot(tree)
################################################################################
##################################   Fig 2   ###################################
################################################################################
### Loading Packages
library(openxlsx)
library(dplyr)
library(tidyr)
library(ggplot2)
library(patchwork)
library(missForest)
library(adephylo)
library(ape)
library(smatr)
library(deming)
library(funrar)
library(BestFitM)
library(ggtrendline)
library(AICcmodavg)
library(pscl)
library(vegan)
library(ggfortify)
library(ggExtra)
library(phytools)
library(lme4qtl)
library(car)
setwd(getwd())
### Analyzing species lists
Common_sp_list = read.xlsx("Data/Common_species_list.xlsx", sheet = "Common_sp_list", colNames = TRUE, rowNames = FALSE)
Common_sp_list_SLA = c(na.omit(Common_sp_list$Species_SLA))
Common_sp_list_AGB = c(na.omit(Common_sp_list$Species_AGB))
### Custom themes and functions
mytheme = theme_bw()+
theme( panel.background = element_rect(fill='white', colour='black'),
panel.grid=element_blank(),
axis.ticks.length = unit(0.4,"lines"),
axis.ticks = element_line(color='black'),
axis.line = element_line(colour = "black"),
axis.title.x=element_text(colour='black', size=13,vjust = 1),
axis.title.y=element_text(colour='black', size=13,vjust = 1),
axis.text=element_text(colour='black',size=11))+
theme(legend.position = "none")+
theme(plot.title = element_text(color = "black", size = 13, hjust = 0.5))
r2 <- function(x) {x$`Sum Sq`[1]/ (x$`Sum Sq`[1] + x$`Sum Sq`[2])}
standr = function(x){(x-min(x))/(max(x)-min(x))}
### Loading tree
phylogenyAux=read.tree("Data/All_species.newick")
to_drop = phylogenyAux$tip.label[!phylogenyAux$tip.label %in% trait_data$Species]
tree <- drop.tip(as.phylo(phylogenyAux), to_drop)
phyloMat = vcv.phylo(tree)
phyloMat = phyloMat / max(phyloMat)
dim(phyloMat)
### Loading pot experiment database (mean value of traits)
pot_trait = read.xlsx("Data/Pot_traits_mean.xlsx", sheet = "Pot_means", colNames = TRUE, rowNames = FALSE)
colnames(pot_trait) <- paste0(colnames(pot_trait), "_pot")
colnames(pot_trait)[1] <- "Species"
nrow(pot_trait)
### Loading field experiment database (mean value of traits)
### Deming regressive analysis
### Specific leaf area
trait_data = read.xlsx("Data/Field_traits_mean.xlsx", sheet = "Field_means", colNames = TRUE, rowNames = FALSE)
colnames(trait_data) <- paste0(colnames(trait_data), "_field")
colnames(trait_data)[1] <- "Species"
nrow(trait_data)
head(trait_data)
trait_data = trait_data %>% left_join(pot_trait, by = "Species") %>%
left_join(Common_sp_list[,c(1,2,5)], by = "Species") %>%
drop_na(SLA_pot) %>% drop_na(SLA_imp_field)
rownames(trait_data) = trait_data$Species
length(unique(trait_data$Species))
trait_data$SLA_imp_field_log = log10(trait_data$SLA_imp_field)
trait_data$SLA_pot_log = log10(trait_data$SLA_pot)
### Pot experiment SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_pot_log'], metric = 'euclidean',center = TRUE, scale = TRUE)
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_pot_dis <- data.frame(SLA_pot_mean = mean_vals, SLA_pot_sd = sd_vals, SLA_pot_se = se_vals)
### Field SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_imp_field_log'], metric = 'euclidean',center = TRUE, scale = TRUE)#gower
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_field_dis <- data.frame(SLA_Field_means = mean_vals, SLA_field_sd = sd_vals, SLA_field_se = se_vals)
SLA_total_dis = cbind(SLA_pot_dis, SLA_field_dis)
SLA_total_dis$Species = rownames(SLA_total_dis)
SLA_total_dis = SLA_total_dis %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
Test_total_dis = SLA_total_dis
rownames(Test_total_dis) = Test_total_dis$Species
###
SLA_pot_di<-Test_total_dis$SLA_pot_mean
names(SLA_pot_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_pot_di, method = "K", test = TRUE, nsim =  1000)
SLA_field_di<-Test_total_dis$SLA_Field_means
names(SLA_field_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_field_di, method = "K", test = TRUE, nsim =  1000)
###
Origin<-Test_total_dis$Origin
names(Origin)<- rownames(Test_total_dis)
### phylANOVA
aov_di <- phylANOVA(tree, Origin, SLA_pot_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
aov_di <- phylANOVA(tree, Origin, SLA_field_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
### The effect of origin and types of experiments on DI
data1 = as.data.frame(SLA_pot_di)
data1$Type = "pot"
data1$Species = rownames(data1)
colnames(data1)[1] = "Di"
rownames(data1) = NULL
data2 = as.data.frame(SLA_field_di)
data2$Type = "field"
data2$Species = rownames(data2)
colnames(data2)[1] = "Di"
rownames(data2) = NULL
###
data_all_di = rbind(data1,data2)
data_all_di = data_all_di %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
shapiro.test(data_all_di$Di)
data_all_di$Origin = factor(data_all_di$Origin, levels = c("Native", "Exotic"))
data_all_di$Type = factor(data_all_di$Type, levels = c("pot", "field"))
data_all_di$Species = as.factor(data_all_di$Species)
mod = relmatLmer(Di ~ Origin*Type + (1|Species), data = data_all_di, relmat = list(Species=phyloMat))
summary(mod)
Anova(mod, type="II", test.statistic ="F")
### Deming regressive
fit <- deming(SLA_Field_means ~ SLA_pot_mean, ystd=SLA_field_sd, xstd=SLA_pot_sd, data=SLA_total_dis)
nrow(pot_trait)
### Loading field experiment database (mean value of traits)
### Deming regressive analysis
### Specific leaf area
trait_data = read.xlsx("Data/Field_traits_mean.xlsx", sheet = "Field_means", colNames = TRUE, rowNames = FALSE)
colnames(trait_data) <- paste0(colnames(trait_data), "_field")
colnames(trait_data)[1] <- "Species"
nrow(trait_data)
head(trait_data)
trait_data = trait_data %>% left_join(pot_trait, by = "Species") %>%
left_join(Common_sp_list[,c(1,2,5)], by = "Species") %>%
drop_na(SLA_pot) %>% drop_na(SLA_imp_field)
rownames(trait_data) = trait_data$Species
length(unique(trait_data$Species))
trait_data$SLA_imp_field_log = log10(trait_data$SLA_imp_field)
trait_data$SLA_pot_log = log10(trait_data$SLA_pot)
### Pot experiment SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_pot_log'], metric = 'euclidean',center = TRUE, scale = TRUE)
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_pot_dis <- data.frame(SLA_pot_mean = mean_vals, SLA_pot_sd = sd_vals, SLA_pot_se = se_vals)
### Field SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_imp_field_log'], metric = 'euclidean',center = TRUE, scale = TRUE)#gower
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_field_dis <- data.frame(SLA_Field_means = mean_vals, SLA_field_sd = sd_vals, SLA_field_se = se_vals)
SLA_total_dis = cbind(SLA_pot_dis, SLA_field_dis)
SLA_total_dis$Species = rownames(SLA_total_dis)
SLA_total_dis = SLA_total_dis %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
Test_total_dis = SLA_total_dis
rownames(Test_total_dis) = Test_total_dis$Species
###
SLA_pot_di<-Test_total_dis$SLA_pot_mean
names(SLA_pot_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_pot_di, method = "K", test = TRUE, nsim =  1000)
SLA_field_di<-Test_total_dis$SLA_Field_means
names(SLA_field_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_field_di, method = "K", test = TRUE, nsim =  1000)
###
Origin<-Test_total_dis$Origin
names(Origin)<- rownames(Test_total_dis)
### phylANOVA
aov_di <- phylANOVA(tree, Origin, SLA_pot_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
aov_di <- phylANOVA(tree, Origin, SLA_field_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
### The effect of origin and types of experiments on DI
data1 = as.data.frame(SLA_pot_di)
data1$Type = "pot"
data1$Species = rownames(data1)
colnames(data1)[1] = "Di"
rownames(data1) = NULL
data2 = as.data.frame(SLA_field_di)
data2$Type = "field"
data2$Species = rownames(data2)
colnames(data2)[1] = "Di"
rownames(data2) = NULL
###
data_all_di = rbind(data1,data2)
data_all_di = data_all_di %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
shapiro.test(data_all_di$Di)
data_all_di$Origin = factor(data_all_di$Origin, levels = c("Native", "Exotic"))
data_all_di$Type = factor(data_all_di$Type, levels = c("pot", "field"))
data_all_di$Species = as.factor(data_all_di$Species)
mod = relmatLmer(Di ~ Origin*Type + (1|Species), data = data_all_di, relmat = list(Species=phyloMat))
summary(mod)
mod = relmatLmer(Di ~ Origin*Type + (1|Species), data = data_all_di, relmat = list(Species=phyloMat))
dim(phyloMat)
### Analyzing species lists
Common_sp_list = read.xlsx("Data/Common_species_list.xlsx", sheet = "Common_sp_list", colNames = TRUE, rowNames = FALSE)
Common_sp_list_SLA = c(na.omit(Common_sp_list$Species_SLA))
Common_sp_list_AGB = c(na.omit(Common_sp_list$Species_AGB))
Common_sp_list
View(Common_sp_list)
### Loading tree
phylogenyAux=read.tree("Data/All_species.newick")
to_drop = phylogenyAux$tip.label[!phylogenyAux$tip.label %in% Common_sp_list$Species]
tree <- drop.tip(as.phylo(phylogenyAux), to_drop)
phyloMat = vcv.phylo(tree)
phyloMat = phyloMat / max(phyloMat)
dim(phyloMat)
### Loading pot experiment database (mean value of traits)
pot_trait = read.xlsx("Data/Pot_traits_mean.xlsx", sheet = "Pot_means", colNames = TRUE, rowNames = FALSE)
colnames(pot_trait) <- paste0(colnames(pot_trait), "_pot")
colnames(pot_trait)[1] <- "Species"
nrow(pot_trait)
### Loading field experiment database (mean value of traits)
### Deming regressive analysis
### Specific leaf area
trait_data = read.xlsx("Data/Field_traits_mean.xlsx", sheet = "Field_means", colNames = TRUE, rowNames = FALSE)
colnames(trait_data) <- paste0(colnames(trait_data), "_field")
colnames(trait_data)[1] <- "Species"
nrow(trait_data)
head(trait_data)
trait_data = trait_data %>% left_join(pot_trait, by = "Species") %>%
left_join(Common_sp_list[,c(1,2,5)], by = "Species") %>%
drop_na(SLA_pot) %>% drop_na(SLA_imp_field)
rownames(trait_data) = trait_data$Species
length(unique(trait_data$Species))
trait_data$SLA_imp_field_log = log10(trait_data$SLA_imp_field)
trait_data$SLA_pot_log = log10(trait_data$SLA_pot)
### Pot experiment SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_pot_log'], metric = 'euclidean',center = TRUE, scale = TRUE)
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_pot_dis <- data.frame(SLA_pot_mean = mean_vals, SLA_pot_sd = sd_vals, SLA_pot_se = se_vals)
### Field SLA differences
dist_mat <- compute_dist_matrix(trait_data['SLA_imp_field_log'], metric = 'euclidean',center = TRUE, scale = TRUE)#gower
dist_mat <- standr(dist_mat)
diag(dist_mat) <- NA
### Calculate the mean of each row (excluding diagonals)
mean_vals <- apply(dist_mat, 1, mean, na.rm = TRUE)
### Calculate the standard deviation for each row (excluding diagonals)
sd_vals <- apply(dist_mat, 1, sd, na.rm = TRUE)
### Calculate the standard error for each line (removing diagonal lines)
se_vals <- sd_vals / sqrt(ncol(dist_mat) - 1)
SLA_field_dis <- data.frame(SLA_Field_means = mean_vals, SLA_field_sd = sd_vals, SLA_field_se = se_vals)
SLA_total_dis = cbind(SLA_pot_dis, SLA_field_dis)
SLA_total_dis$Species = rownames(SLA_total_dis)
SLA_total_dis = SLA_total_dis %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
Test_total_dis = SLA_total_dis
rownames(Test_total_dis) = Test_total_dis$Species
###
SLA_pot_di<-Test_total_dis$SLA_pot_mean
names(SLA_pot_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_pot_di, method = "K", test = TRUE, nsim =  1000)
SLA_field_di<-Test_total_dis$SLA_Field_means
names(SLA_field_di)<- rownames(Test_total_dis)
phytools::phylosig(tree, SLA_field_di, method = "K", test = TRUE, nsim =  1000)
###
Origin<-Test_total_dis$Origin
names(Origin)<- rownames(Test_total_dis)
### phylANOVA
aov_di <- phylANOVA(tree, Origin, SLA_pot_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
aov_di <- phylANOVA(tree, Origin, SLA_field_di, nsim = 1000, posthoc=TRUE, p.adj = 'bonferroni')
aov_di
r2(aov_di)
### The effect of origin and types of experiments on DI
data1 = as.data.frame(SLA_pot_di)
data1$Type = "pot"
data1$Species = rownames(data1)
colnames(data1)[1] = "Di"
rownames(data1) = NULL
data2 = as.data.frame(SLA_field_di)
data2$Type = "field"
data2$Species = rownames(data2)
colnames(data2)[1] = "Di"
rownames(data2) = NULL
###
data_all_di = rbind(data1,data2)
data_all_di = data_all_di %>% left_join(Common_sp_list[,c(1,2,5)], by = "Species")
###
shapiro.test(data_all_di$Di)
data_all_di$Origin = factor(data_all_di$Origin, levels = c("Native", "Exotic"))
data_all_di$Type = factor(data_all_di$Type, levels = c("pot", "field"))
data_all_di$Species = as.factor(data_all_di$Species)
mod = relmatLmer(Di ~ Origin*Type + (1|Species), data = data_all_di, relmat = list(Species=phyloMat))
summary(mod)
Anova(mod, type="II", test.statistic ="F")
### Deming regressive
fit <- deming(SLA_Field_means ~ SLA_pot_mean, ystd=SLA_field_sd, xstd=SLA_pot_sd, data=SLA_total_dis)
print(fit)
